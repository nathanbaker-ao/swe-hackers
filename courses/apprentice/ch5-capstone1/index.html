<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Capstone I: The Adventure Game | The Apprentice's Path</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=JetBrains+Mono&family=Space+Grotesk:wght@500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../../shared/css/lesson-interactive.css">
</head>
<body data-course="apprentice" data-lesson="ch5-capstone1">
  <header class="header">
    <div class="header-content">
      <a href="../../index.html" class="logo">
        <div class="logo-icon">ğŸ®</div>
        <span>Capstone I</span>
      </a>
      <nav class="nav-links">
        <a href="../index.html">â† Apprentice</a>
        <a href="../ch4-architect/">Ch 4</a>
        <a href="index.html" class="active">Ch 5</a>
        <a href="../ch6-capstone2/">Ch 6: Capstone II</a>
      </nav>
    </div>
  </header>

  <main class="container">
    <div class="page-header">
      <div class="breadcrumb">
        <a href="../index.html">Apprentice</a>
        <span>/</span>
        <span>Capstone I: The Adventure Game</span>
      </div>
      <h1>ğŸ® Capstone I: The Adventure Game</h1>
      <p>Put everything together! Build a text-based adventure game where players explore rooms, collect items, and make choices.</p>
    </div>

    <!-- Audio Info -->
    <section class="section audio-info-section">
      <div class="info-box compact">
        <div class="info-header">
          <span class="info-icon">ğŸ™ï¸</span>
          <div>
            <h4>Interactive Learning Experience</h4>
            <p>Watch diagrams come alive with AI narration â€¢ Click dots to jump â€¢ Test your understanding with quizzes</p>
          </div>
        </div>
        <div class="voice-options">
          <span class="voice-badge">ğŸ‘©â€ğŸ¤ Female Storyteller</span>
          <span class="voice-badge">ğŸ© Male UK Storyteller</span>
        </div>
      </div>
    </section>

    <!-- Story 1: The Adventure Vision -->
    <section class="section" id="adventure-vision-section">
      <h2>The Adventure Vision</h2>
      <p>Before you write a single line of code, understand what you're building. A text adventure is an interactive story where players type commands to explore, collect, and conquer!</p>
      
      <div class="diagram-container" id="adventure-vision-container">
        <div class="diagram-header">
          <span class="diagram-title">ğŸ† What You're Building</span>
        </div>
        <div id="adventure-vision-story" class="diagram-canvas storytelling"></div>
        
        <div class="diagram-story" id="adventure-vision-story-caption">
          <div class="story-step">
            <div class="story-icon visible">ğŸš€</div>
            <div class="story-content">
              <div class="story-title visible">Ready to Explore</div>
              <div class="story-text visible">Click any progress dot below to jump to that step, or press Play to watch the full story unfold.</div>
              <div class="story-connection" style="display: none;">
                <span class="arrow">â†’</span>
                <span class="connection-text"></span>
              </div>
            </div>
          </div>
        </div>

        <div class="playback-controls">
          <div class="playback-left">
            <button class="diagram-btn play-btn" data-action="play">â–¶ Play</button>
          </div>
          <div class="playback-center">
            <div class="story-progress" id="adventure-vision-story-progress"></div>
          </div>
          <div class="playback-right">
            <button class="diagram-btn small" data-action="fit" title="Fit to view">Fit</button>
            <button class="diagram-btn small" data-action="reset" title="Reset view">Reset</button>
          </div>
        </div>

        <div class="settings-bar">
          <div class="control-group">
            <label>â±ï¸</label>
            <select id="adventure-vision-speed-select">
              <option value="1000">1s</option>
              <option value="2000" selected>2s</option>
              <option value="5000">5s</option>
              <option value="10000">10s</option>
            </select>
          </div>
          <div class="control-group">
            <button class="audio-toggle" id="adventure-vision-audio-toggle" title="Toggle audio narration">
              <span class="audio-icon">ğŸ”Š</span>
            </button>
          </div>
          <div class="control-group">
            <label>ğŸ¤</label>
            <select id="adventure-vision-voice-select" class="voice-select">
              <option value="">Loading...</option>
            </select>
          </div>
        </div>
      </div>

      <div class="quiz-card" id="adventure-vision-quiz">
        <div class="quiz-header">
          <h4>ğŸ“ Check Your Understanding</h4>
          <div class="quiz-progress">
            <span class="answered">0</span>/<span class="total">3</span> answered
            <span class="score"></span>
          </div>
        </div>
        <div class="quiz-carousel"></div>
        <div class="quiz-nav">
          <button class="quiz-nav-btn prev" disabled>â† Prev</button>
          <div class="quiz-dots"></div>
          <button class="quiz-nav-btn next">Next â†’</button>
        </div>
      </div>
    </section>

    <!-- Story 2: Game Planning -->
    <section class="section" id="game-planning-section">
      <h2>Planning Your Game</h2>
      <p>Good architects always draw a map first. Learn how to plan your rooms, items, and win conditions before writing any code.</p>
      
      <div class="diagram-container" id="game-planning-container">
        <div class="diagram-header">
          <span class="diagram-title">ğŸ“‹ Your Game Blueprint</span>
        </div>
        <div id="game-planning-story" class="diagram-canvas storytelling"></div>
        
        <div class="diagram-story" id="game-planning-story-caption">
          <div class="story-step">
            <div class="story-icon visible">ğŸš€</div>
            <div class="story-content">
              <div class="story-title visible">Ready to Explore</div>
              <div class="story-text visible">Click any progress dot below to jump to that step, or press Play to watch the full story unfold.</div>
              <div class="story-connection" style="display: none;">
                <span class="arrow">â†’</span>
                <span class="connection-text"></span>
              </div>
            </div>
          </div>
        </div>

        <div class="playback-controls">
          <div class="playback-left">
            <button class="diagram-btn play-btn" data-action="play">â–¶ Play</button>
          </div>
          <div class="playback-center">
            <div class="story-progress" id="game-planning-story-progress"></div>
          </div>
          <div class="playback-right">
            <button class="diagram-btn small" data-action="fit" title="Fit to view">Fit</button>
            <button class="diagram-btn small" data-action="reset" title="Reset view">Reset</button>
          </div>
        </div>

        <div class="settings-bar">
          <div class="control-group">
            <label>â±ï¸</label>
            <select id="game-planning-speed-select">
              <option value="1000">1s</option>
              <option value="2000" selected>2s</option>
              <option value="5000">5s</option>
              <option value="10000">10s</option>
            </select>
          </div>
          <div class="control-group">
            <button class="audio-toggle" id="game-planning-audio-toggle" title="Toggle audio narration">
              <span class="audio-icon">ğŸ”Š</span>
            </button>
          </div>
          <div class="control-group">
            <label>ğŸ¤</label>
            <select id="game-planning-voice-select" class="voice-select">
              <option value="">Loading...</option>
            </select>
          </div>
        </div>
      </div>

      <div class="quiz-card" id="game-planning-quiz">
        <div class="quiz-header">
          <h4>ğŸ“ Check Your Understanding</h4>
          <div class="quiz-progress">
            <span class="answered">0</span>/<span class="total">3</span> answered
            <span class="score"></span>
          </div>
        </div>
        <div class="quiz-carousel"></div>
        <div class="quiz-nav">
          <button class="quiz-nav-btn prev" disabled>â† Prev</button>
          <div class="quiz-dots"></div>
          <button class="quiz-nav-btn next">Next â†’</button>
        </div>
      </div>
    </section>

    <!-- Story 3: Skills Integration -->
    <section class="section" id="skills-integration-section">
      <h2>Putting It All Together</h2>
      <p>This capstone combines every skill you've learned: Stone for memory, Lightning for flow, and Magnetism for reusable functions. Watch how they work together!</p>
      
      <div class="diagram-container" id="skills-integration-container">
        <div class="diagram-header">
          <span class="diagram-title">ğŸ”— Your Complete Toolkit</span>
        </div>
        <div id="skills-integration-story" class="diagram-canvas storytelling"></div>
        
        <div class="diagram-story" id="skills-integration-story-caption">
          <div class="story-step">
            <div class="story-icon visible">ğŸš€</div>
            <div class="story-content">
              <div class="story-title visible">Ready to Explore</div>
              <div class="story-text visible">Click any progress dot below to jump to that step, or press Play to watch the full story unfold.</div>
              <div class="story-connection" style="display: none;">
                <span class="arrow">â†’</span>
                <span class="connection-text"></span>
              </div>
            </div>
          </div>
        </div>

        <div class="playback-controls">
          <div class="playback-left">
            <button class="diagram-btn play-btn" data-action="play">â–¶ Play</button>
          </div>
          <div class="playback-center">
            <div class="story-progress" id="skills-integration-story-progress"></div>
          </div>
          <div class="playback-right">
            <button class="diagram-btn small" data-action="fit" title="Fit to view">Fit</button>
            <button class="diagram-btn small" data-action="reset" title="Reset view">Reset</button>
          </div>
        </div>

        <div class="settings-bar">
          <div class="control-group">
            <label>â±ï¸</label>
            <select id="skills-integration-speed-select">
              <option value="1000">1s</option>
              <option value="2000" selected>2s</option>
              <option value="5000">5s</option>
              <option value="10000">10s</option>
            </select>
          </div>
          <div class="control-group">
            <button class="audio-toggle" id="skills-integration-audio-toggle" title="Toggle audio narration">
              <span class="audio-icon">ğŸ”Š</span>
            </button>
          </div>
          <div class="control-group">
            <label>ğŸ¤</label>
            <select id="skills-integration-voice-select" class="voice-select">
              <option value="">Loading...</option>
            </select>
          </div>
        </div>
      </div>

      <div class="quiz-card" id="skills-integration-quiz">
        <div class="quiz-header">
          <h4>ğŸ“ Check Your Understanding</h4>
          <div class="quiz-progress">
            <span class="answered">0</span>/<span class="total">3</span> answered
            <span class="score"></span>
          </div>
        </div>
        <div class="quiz-carousel"></div>
        <div class="quiz-nav">
          <button class="quiz-nav-btn prev" disabled>â† Prev</button>
          <div class="quiz-dots"></div>
          <button class="quiz-nav-btn next">Next â†’</button>
        </div>
      </div>
    </section>

    <!-- Next Steps -->
    <section class="section">
      <h2>Ready to Build?</h2>
      <p>You've seen the vision, learned how to plan, and understand how your skills connect. Now it's time to create your own adventure! After completing this capstone, continue to Capstone II for an even bigger challenge.</p>
      <div class="cards-grid" style="grid-template-columns: repeat(2, 1fr);">
        <a href="../ch6-capstone2/" class="card">
          <div class="card-icon">ğŸš€</div>
          <h3>Chapter 6: Capstone II</h3>
          <p>Take your skills further with a more advanced project challenge.</p>
        </a>
        <a href="../index.html" class="card">
          <div class="card-icon">ğŸ“š</div>
          <h3>Course Overview</h3>
          <p>See all chapters in The Apprentice's Path.</p>
        </a>
      </div>
    </section>
  </main>

  <nav class="page-nav">
    <h4>On This Page</h4>
    <ul>
      <li><a href="#adventure-vision-section">The Adventure Vision</a></li>
      <li><a href="#game-planning-section">Planning Your Game</a></li>
      <li><a href="#skills-integration-section">Putting It All Together</a></li>
    </ul>
  </nav>

  <button class="back-to-top" title="Back to top">â†‘</button>

  <!-- External Libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.2/anime.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.28.1/cytoscape.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/dagre/0.8.5/dagre.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/cytoscape-dagre@2.5.0/cytoscape-dagre.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/cytoscape-cose-bilkent@4.1.0/cytoscape-cose-bilkent.min.js"></script>
  
  <!-- Interactive Engines -->
  <script src="../../shared/js/interactive/diagram-utils.js"></script>
  <script src="../../shared/js/interactive/audio-engine.js"></script>
  <script src="../../shared/js/interactive/storytelling-diagram.js"></script>
  <script src="../../shared/js/interactive/quiz-system.js"></script>
  
  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      // Initialize page animations
      DiagramUtils.initPageAnimations();
      DiagramUtils.setupBackToTop();

      // Load story and quiz data from JSON
      const response = await fetch('story.json');
      const pageData = await response.json();

      // Create a shared audio engine pointing to the audio folder
      const audioEngine = new AudioNarrationEngine('audio');

      // ============================================
      // DIAGRAM ELEMENTS (Cytoscape data)
      // ============================================

      const diagramElements = {
        'adventure-vision': [
          // Nodes
          { data: { id: 'the-challenge', label: 'ğŸ† The Challenge\nCapstone Project', type: 'concept', description: 'Put all your skills together' } },
          { data: { id: 'text-adventure', label: 'ğŸ® Text Adventure\nInteractive Story', type: 'example', description: 'A game controlled by typed commands' } },
          { data: { id: 'player-experience', label: 'ğŸ‘¤ Player\nExperience', type: 'external', description: 'Explore, collect, and conquer' } },
          { data: { id: 'combine-skills', label: 'ğŸ”— All Skills\nCombined', type: 'service', description: 'Stone, Lightning, Magnetism' } },
          { data: { id: 'victory-moment', label: 'ğŸ‰ Victory!\nYou Built It', type: 'page', description: 'Your code creates magic' } },
          // Edges
          { data: { source: 'the-challenge', target: 'text-adventure' } },
          { data: { source: 'text-adventure', target: 'player-experience' } },
          { data: { source: 'player-experience', target: 'combine-skills' } },
          { data: { source: 'combine-skills', target: 'victory-moment' } }
        ],

        'game-planning': [
          // Nodes
          { data: { id: 'architects-plan', label: 'ğŸ“‹ Plan First\nArchitects Draw', type: 'concept', description: 'Design before coding' } },
          { data: { id: 'draw-map', label: 'ğŸ—ºï¸ Draw Map\nRooms & Paths', type: 'example', description: 'Sketch connections' } },
          { data: { id: 'define-rooms', label: 'ğŸšª Define Rooms\nDescription + Exits', type: 'data', description: 'What players see and where they go' } },
          { data: { id: 'add-items', label: 'ğŸ—ï¸ Add Items\nCollectibles', type: 'auth', description: 'Rewards and tools' } },
          { data: { id: 'win-condition', label: 'ğŸ Win Condition\nThe Goal', type: 'page', description: 'What players strive for' } },
          // Edges
          { data: { source: 'architects-plan', target: 'draw-map' } },
          { data: { source: 'draw-map', target: 'define-rooms' } },
          { data: { source: 'define-rooms', target: 'add-items' } },
          { data: { source: 'add-items', target: 'win-condition' } }
        ],

        'skills-integration': [
          // Nodes
          { data: { id: 'all-skills', label: 'â­ Your Toolkit\nComplete Skills', type: 'concept', description: 'Everything you learned' } },
          { data: { id: 'stone-memory', label: 'ğŸª¨ Stone\nGame Memory', type: 'data', description: 'Variables track state' } },
          { data: { id: 'lightning-flow', label: 'âš¡ Lightning\nDecision Making', type: 'auth', description: 'If/else and while loops' } },
          { data: { id: 'magnetism-functions', label: 'ğŸ§² Magnetism\nReusable Actions', type: 'service', description: 'Functions for each action' } },
          { data: { id: 'game-loop', label: 'ğŸ”„ Game Loop\nThe Heartbeat', type: 'example', description: 'Show, get, process, repeat' } },
          { data: { id: 'your-game', label: 'ğŸ® Your Game\nComplete!', type: 'page', description: 'An experience you created' } },
          // Edges
          { data: { source: 'all-skills', target: 'stone-memory' } },
          { data: { source: 'all-skills', target: 'lightning-flow' } },
          { data: { source: 'all-skills', target: 'magnetism-functions' } },
          { data: { source: 'stone-memory', target: 'game-loop' } },
          { data: { source: 'lightning-flow', target: 'game-loop' } },
          { data: { source: 'magnetism-functions', target: 'game-loop' } },
          { data: { source: 'game-loop', target: 'your-game' } }
        ]
      };

      // ============================================
      // INITIALIZE STORYTELLING DIAGRAMS
      // ============================================

      // Map story IDs to diagram element keys
      const storyToDiagram = {
        'adventure-vision-story': 'adventure-vision',
        'game-planning-story': 'game-planning',
        'skills-integration-story': 'skills-integration'
      };

      // Create storytelling diagrams for each story in the JSON
      pageData.stories.forEach(story => {
        const diagramKey = storyToDiagram[story.id];
        if (!diagramKey) return;

        const elements = diagramElements[diagramKey];
        if (!elements) return;

        new StorytellingDiagram(
          story.id,
          elements,
          story.steps,
          { audioEngine, storyId: story.id }
        );
      });

      // ============================================
      // INITIALIZE QUIZZES
      // ============================================

      // Map story IDs to quiz container IDs
      const storyToQuiz = {
        'adventure-vision-story': 'adventure-vision-quiz',
        'game-planning-story': 'game-planning-quiz',
        'skills-integration-story': 'skills-integration-quiz'
      };

      pageData.quizzes.forEach(quiz => {
        const containerId = storyToQuiz[quiz.storyId];
        if (!containerId) return;

        new Quiz(containerId, quiz.questions);
      });
    });
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chapter 2: Lightning Strikes | The Apprentice's Path</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=JetBrains+Mono&family=Space+Grotesk:wght@500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../../shared/css/lesson-interactive.css">
</head>
<body data-course="apprentice" data-lesson="ch2-lightning">
  <header class="header">
    <div class="header-content">
      <a href="../../index.html" class="logo">
        <div class="logo-icon">âš¡</div>
        <span>Lightning Strikes</span>
      </a>
      <nav class="nav-links">
        <a href="../index.html">â† Apprentice</a>
        <a href="../ch1-stone/">Ch 1</a>
        <a href="index.html" class="active">Ch 2</a>
        <a href="../ch3-magnetism/">Ch 3: Magnetism</a>
      </nav>
    </div>
  </header>

  <main class="container">
    <div class="page-header">
      <div class="breadcrumb">
        <a href="../index.html">Apprentice</a>
        <span>/</span>
        <span>Chapter 2: Lightning Strikes</span>
      </div>
      <h1>âš¡ Lightning Strikes</h1>
      <p>The stone remembers, but lightning decides. Learn to make your programs think, choose different paths, and repeat actions with control flow, conditionals, and loops.</p>
    </div>

    <!-- Audio Info -->
    <section class="section audio-info-section">
      <div class="info-box compact">
        <div class="info-header">
          <span class="info-icon">ğŸ™ï¸</span>
          <div>
            <h4>Interactive Learning Experience</h4>
            <p>Watch diagrams come alive with AI narration â€¢ Click dots to jump â€¢ Test your understanding with quizzes</p>
          </div>
        </div>
        <div class="voice-options">
          <span class="voice-badge">ğŸ‘©â€ğŸ¤ Female Storyteller</span>
          <span class="voice-badge">ğŸ© Male UK Storyteller</span>
        </div>
      </div>
    </section>

    <!-- Story 1: Control Flow -->
    <section class="section" id="control-flow-section">
      <h2>The Path of Lightning</h2>
      <p>Without control flow, programs are like trains on tracksâ€”they can only go one way. With it, your code can think, react, and take different paths based on conditions.</p>
      
      <div class="diagram-container" id="control-flow-container">
        <div class="diagram-header">
          <span class="diagram-title">âš¡ Linear vs. Branching Programs</span>
        </div>
        <div id="control-flow-story" class="diagram-canvas storytelling"></div>
        
        <div class="diagram-story" id="control-flow-story-caption">
          <div class="story-step">
            <div class="story-icon visible">ğŸš€</div>
            <div class="story-content">
              <div class="story-title visible">Ready to Explore</div>
              <div class="story-text visible">Click any progress dot below to jump to that step, or press Play to watch the full story unfold.</div>
              <div class="story-connection" style="display: none;">
                <span class="arrow">â†’</span>
                <span class="connection-text"></span>
              </div>
            </div>
          </div>
        </div>

        <div class="playback-controls">
          <div class="playback-left">
            <button class="diagram-btn play-btn" data-action="play">â–¶ Play</button>
          </div>
          <div class="playback-center">
            <div class="story-progress" id="control-flow-story-progress"></div>
          </div>
          <div class="playback-right">
            <button class="diagram-btn small" data-action="fit" title="Fit to view">Fit</button>
            <button class="diagram-btn small" data-action="reset" title="Reset view">Reset</button>
          </div>
        </div>

        <div class="settings-bar">
          <div class="control-group">
            <label>â±ï¸</label>
            <select id="control-flow-speed-select">
              <option value="1000">1s</option>
              <option value="2000" selected>2s</option>
              <option value="5000">5s</option>
              <option value="10000">10s</option>
            </select>
          </div>
          <div class="control-group">
            <button class="audio-toggle" id="control-flow-audio-toggle" title="Toggle audio narration">
              <span class="audio-icon">ğŸ”Š</span>
            </button>
          </div>
          <div class="control-group">
            <label>ğŸ¤</label>
            <select id="control-flow-voice-select" class="voice-select">
              <option value="">Loading...</option>
            </select>
          </div>
        </div>
      </div>

      <div class="quiz-card" id="control-flow-quiz">
        <div class="quiz-header">
          <h4>ğŸ“ Check Your Understanding</h4>
          <div class="quiz-progress">
            <span class="answered">0</span>/<span class="total">3</span> answered
            <span class="score"></span>
          </div>
        </div>
        <div class="quiz-carousel"></div>
        <div class="quiz-nav">
          <button class="quiz-nav-btn prev" disabled>â† Prev</button>
          <div class="quiz-dots"></div>
          <button class="quiz-nav-btn next">Next â†’</button>
        </div>
      </div>
    </section>

    <!-- Story 2: Decisions -->
    <section class="section" id="decisions-section">
      <h2>Making Decisions</h2>
      <p>Every decision in programming is a yes-or-no question. Learn how to use comparison operators and if/elif/else statements to make your programs react intelligently.</p>
      
      <div class="diagram-container" id="decisions-container">
        <div class="diagram-header">
          <span class="diagram-title">ğŸš¦ If, Elif, Else: The Decision Tree</span>
        </div>
        <div id="decisions-story" class="diagram-canvas storytelling"></div>
        
        <div class="diagram-story" id="decisions-story-caption">
          <div class="story-step">
            <div class="story-icon visible">ğŸš€</div>
            <div class="story-content">
              <div class="story-title visible">Ready to Explore</div>
              <div class="story-text visible">Click any progress dot below to jump to that step, or press Play to watch the full story unfold.</div>
              <div class="story-connection" style="display: none;">
                <span class="arrow">â†’</span>
                <span class="connection-text"></span>
              </div>
            </div>
          </div>
        </div>

        <div class="playback-controls">
          <div class="playback-left">
            <button class="diagram-btn play-btn" data-action="play">â–¶ Play</button>
          </div>
          <div class="playback-center">
            <div class="story-progress" id="decisions-story-progress"></div>
          </div>
          <div class="playback-right">
            <button class="diagram-btn small" data-action="fit" title="Fit to view">Fit</button>
            <button class="diagram-btn small" data-action="reset" title="Reset view">Reset</button>
          </div>
        </div>

        <div class="settings-bar">
          <div class="control-group">
            <label>â±ï¸</label>
            <select id="decisions-speed-select">
              <option value="1000">1s</option>
              <option value="2000" selected>2s</option>
              <option value="5000">5s</option>
              <option value="10000">10s</option>
            </select>
          </div>
          <div class="control-group">
            <button class="audio-toggle" id="decisions-audio-toggle" title="Toggle audio narration">
              <span class="audio-icon">ğŸ”Š</span>
            </button>
          </div>
          <div class="control-group">
            <label>ğŸ¤</label>
            <select id="decisions-voice-select" class="voice-select">
              <option value="">Loading...</option>
            </select>
          </div>
        </div>
      </div>

      <div class="quiz-card" id="decisions-quiz">
        <div class="quiz-header">
          <h4>ğŸ“ Check Your Understanding</h4>
          <div class="quiz-progress">
            <span class="answered">0</span>/<span class="total">3</span> answered
            <span class="score"></span>
          </div>
        </div>
        <div class="quiz-carousel"></div>
        <div class="quiz-nav">
          <button class="quiz-nav-btn prev" disabled>â† Prev</button>
          <div class="quiz-dots"></div>
          <button class="quiz-nav-btn next">Next â†’</button>
        </div>
      </div>
    </section>

    <!-- Story 3: Loops -->
    <section class="section" id="loops-section">
      <h2>The Art of Repetition</h2>
      <p>Why write the same code a hundred times when you can write it once? Master for loops and while loops to make your programs work tirelessly.</p>
      
      <div class="diagram-container" id="loops-container">
        <div class="diagram-header">
          <span class="diagram-title">ğŸ”„ For Loops & While Loops</span>
        </div>
        <div id="loops-story" class="diagram-canvas storytelling"></div>
        
        <div class="diagram-story" id="loops-story-caption">
          <div class="story-step">
            <div class="story-icon visible">ğŸš€</div>
            <div class="story-content">
              <div class="story-title visible">Ready to Explore</div>
              <div class="story-text visible">Click any progress dot below to jump to that step, or press Play to watch the full story unfold.</div>
              <div class="story-connection" style="display: none;">
                <span class="arrow">â†’</span>
                <span class="connection-text"></span>
              </div>
            </div>
          </div>
        </div>

        <div class="playback-controls">
          <div class="playback-left">
            <button class="diagram-btn play-btn" data-action="play">â–¶ Play</button>
          </div>
          <div class="playback-center">
            <div class="story-progress" id="loops-story-progress"></div>
          </div>
          <div class="playback-right">
            <button class="diagram-btn small" data-action="fit" title="Fit to view">Fit</button>
            <button class="diagram-btn small" data-action="reset" title="Reset view">Reset</button>
          </div>
        </div>

        <div class="settings-bar">
          <div class="control-group">
            <label>â±ï¸</label>
            <select id="loops-speed-select">
              <option value="1000">1s</option>
              <option value="2000" selected>2s</option>
              <option value="5000">5s</option>
              <option value="10000">10s</option>
            </select>
          </div>
          <div class="control-group">
            <button class="audio-toggle" id="loops-audio-toggle" title="Toggle audio narration">
              <span class="audio-icon">ğŸ”Š</span>
            </button>
          </div>
          <div class="control-group">
            <label>ğŸ¤</label>
            <select id="loops-voice-select" class="voice-select">
              <option value="">Loading...</option>
            </select>
          </div>
        </div>
      </div>

      <div class="quiz-card" id="loops-quiz">
        <div class="quiz-header">
          <h4>ğŸ“ Check Your Understanding</h4>
          <div class="quiz-progress">
            <span class="answered">0</span>/<span class="total">3</span> answered
            <span class="score"></span>
          </div>
        </div>
        <div class="quiz-carousel"></div>
        <div class="quiz-nav">
          <button class="quiz-nav-btn prev" disabled>â† Prev</button>
          <div class="quiz-dots"></div>
          <button class="quiz-nav-btn next">Next â†’</button>
        </div>
      </div>
    </section>

    <!-- Next Steps -->
    <section class="section">
      <h2>Ready for Chapter 3?</h2>
      <p>You've learned to make programs think and repeat. Now it's time to organize code into reusable piecesâ€”functions that work like machines, taking inputs and producing outputs!</p>
      <div class="cards-grid" style="grid-template-columns: repeat(2, 1fr);">
        <a href="../ch3-magnetism/" class="card">
          <div class="card-icon">ğŸ§²</div>
          <h3>Chapter 3: The Pull of Magnetism</h3>
          <p>Learn about functions, parameters, and how to organize your code into reusable building blocks.</p>
        </a>
        <a href="../index.html" class="card">
          <div class="card-icon">ğŸ“š</div>
          <h3>Course Overview</h3>
          <p>See all chapters in The Apprentice's Path.</p>
        </a>
      </div>
    </section>
  </main>

  <nav class="page-nav">
    <h4>On This Page</h4>
    <ul>
      <li><a href="#control-flow-section">Control Flow</a></li>
      <li><a href="#decisions-section">Decisions</a></li>
      <li><a href="#loops-section">Loops</a></li>
    </ul>
  </nav>

  <button class="back-to-top" title="Back to top">â†‘</button>

  <!-- External Libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.2/anime.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.28.1/cytoscape.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/dagre/0.8.5/dagre.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/cytoscape-dagre@2.5.0/cytoscape-dagre.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/cytoscape-cose-bilkent@4.1.0/cytoscape-cose-bilkent.min.js"></script>
  
  <!-- Interactive Engines -->
  <script src="../../shared/js/interactive/diagram-utils.js"></script>
  <script src="../../shared/js/interactive/audio-engine.js"></script>
  <script src="../../shared/js/interactive/storytelling-diagram.js"></script>
  <script src="../../shared/js/interactive/quiz-system.js"></script>
  
  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      // Initialize page animations
      DiagramUtils.initPageAnimations();
      DiagramUtils.setupBackToTop();

      // Load story and quiz data from JSON
      const response = await fetch('story.json');
      const pageData = await response.json();

      // Create a shared audio engine pointing to the audio folder
      const audioEngine = new AudioNarrationEngine('audio');

      // ============================================
      // DIAGRAM ELEMENTS (Cytoscape data)
      // ============================================

      const diagramElements = {
        'control-flow': [
          // Linear program
          { data: { id: 'linear-program', label: 'ğŸš‚ Linear\nProgram', type: 'external', description: 'Runs straight through, no choices' } },
          // The crossroads
          { data: { id: 'crossroads', label: 'ğŸ® Crossroads\nInput?', type: 'concept', description: 'Where decisions happen' } },
          // Control flow
          { data: { id: 'control-flow', label: 'âš¡ Control\nFlow', type: 'auth', description: 'The power to direct program paths' } },
          // Branching and repetition
          { data: { id: 'branching', label: 'ğŸŒ³ Branching\nif/elif/else', type: 'service', description: 'Multiple paths based on conditions' } },
          { data: { id: 'repetition', label: 'ğŸ” Repetition\nfor/while', type: 'data', description: 'Repeat actions efficiently' } },
          // Smart programs
          { data: { id: 'smart-programs', label: 'ğŸ§  Smart\nPrograms', type: 'page', description: 'Programs that think and react' } },
          // Edges
          { data: { source: 'linear-program', target: 'crossroads' } },
          { data: { source: 'crossroads', target: 'control-flow' } },
          { data: { source: 'control-flow', target: 'branching' } },
          { data: { source: 'control-flow', target: 'repetition' } },
          { data: { source: 'branching', target: 'smart-programs' } },
          { data: { source: 'repetition', target: 'smart-programs' } }
        ],

        'decisions': [
          // Yes/No questions
          { data: { id: 'yes-no', label: 'â“ Yes/No\nQuestions', type: 'external', description: 'All decisions are true or false' } },
          // Comparison operators
          { data: { id: 'comparison', label: 'âš–ï¸ Comparisons\n== != > <', type: 'concept', description: 'How we ask questions in code' } },
          // If statement
          { data: { id: 'if-statement', label: 'ğŸš¦ If\nStatement', type: 'auth', description: 'The gatekeeper of conditions' } },
          // Elif/else
          { data: { id: 'elif-else', label: 'ğŸ”€ Elif/Else\nChain', type: 'service', description: 'Multiple conditions, first match wins' } },
          // Indentation
          { data: { id: 'indentation', label: 'ğŸ“ Indentation\n4 Spaces', type: 'data', description: 'How Python knows code structure' } },
          // Power of decisions
          { data: { id: 'decision-power', label: 'ğŸ’¡ Reactive\nPrograms', type: 'page', description: 'Code that responds to input' } },
          // Edges
          { data: { source: 'yes-no', target: 'comparison' } },
          { data: { source: 'comparison', target: 'if-statement' } },
          { data: { source: 'if-statement', target: 'elif-else' } },
          { data: { source: 'elif-else', target: 'indentation' } },
          { data: { source: 'indentation', target: 'decision-power' } }
        ],

        'loops': [
          // Repetition problem
          { data: { id: 'repetition-problem', label: 'ğŸ˜¤ Repetition\nProblem', type: 'external', description: 'Writing same code 100 times?' } },
          // Loop concept
          { data: { id: 'loop-concept', label: 'ğŸ”„ The Loop\nSolution', type: 'concept', description: 'Write once, repeat many' } },
          // For loop
          { data: { id: 'for-loop', label: 'ğŸ”¢ For Loop\nfor x in...', type: 'auth', description: 'Known number of iterations' } },
          // Range
          { data: { id: 'range-function', label: 'ğŸ“ Range\nrange(1, 6)', type: 'data', description: 'Generates numbers 1-5' } },
          // While loop
          { data: { id: 'while-loop', label: 'â³ While Loop\nwhile True:', type: 'service', description: 'Unknown number of iterations' } },
          // Loop control
          { data: { id: 'loop-control', label: 'ğŸ›‘ Control\nbreak/continue', type: 'page', description: 'Exit or skip iterations' } },
          // Edges
          { data: { source: 'repetition-problem', target: 'loop-concept' } },
          { data: { source: 'loop-concept', target: 'for-loop' } },
          { data: { source: 'loop-concept', target: 'while-loop' } },
          { data: { source: 'for-loop', target: 'range-function' } },
          { data: { source: 'for-loop', target: 'loop-control' } },
          { data: { source: 'while-loop', target: 'loop-control' } }
        ]
      };

      // ============================================
      // INITIALIZE STORYTELLING DIAGRAMS
      // ============================================

      // Map story IDs to diagram element keys
      const storyToDiagram = {
        'control-flow-story': 'control-flow',
        'decisions-story': 'decisions',
        'loops-story': 'loops'
      };

      // Create storytelling diagrams for each story in the JSON
      pageData.stories.forEach(story => {
        const diagramKey = storyToDiagram[story.id];
        if (!diagramKey) return;

        const elements = diagramElements[diagramKey];
        if (!elements) return;

        new StorytellingDiagram(
          story.id,
          elements,
          story.steps,
          { audioEngine, storyId: story.id }
        );
      });

      // ============================================
      // INITIALIZE QUIZZES
      // ============================================

      // Map story IDs to quiz container IDs
      const storyToQuiz = {
        'control-flow-story': 'control-flow-quiz',
        'decisions-story': 'decisions-quiz',
        'loops-story': 'loops-quiz'
      };

      pageData.quizzes.forEach(quiz => {
        const containerId = storyToQuiz[quiz.storyId];
        if (!containerId) return;

        new Quiz(containerId, quiz.questions);
      });
    });
  </script>
</body>
</html>

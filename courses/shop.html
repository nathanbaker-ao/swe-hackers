<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Primary Meta Tags -->
  <title>Shop - Merch, Courses & Gear | AutoNateAI</title>
  <meta name="title" content="Shop - Merch, Courses & Gear | AutoNateAI">
  <meta name="description" content="Premium AI-inspired streetwear, developer courses, and starter packs. Engineer your future. Wear the code. We Bot dat life.">

  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://autonateai.com/shop">
  <meta property="og:title" content="Shop - Merch, Courses & Gear | AutoNateAI">
  <meta property="og:description" content="Premium AI-inspired streetwear, developer courses, and starter packs for builders and innovators.">
  <meta property="og:image" content="assets/og-shop.png">

  <!-- Twitter -->
  <meta property="twitter:card" content="summary_large_image">
  <meta property="twitter:url" content="https://autonateai.com/shop">
  <meta property="twitter:title" content="Shop - Merch, Courses & Gear | AutoNateAI">
  <meta property="twitter:description" content="Premium AI-inspired streetwear, developer courses, and starter packs for builders and innovators.">
  <meta property="twitter:image" content="assets/og-shop.png">

  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>&#x1F3DB;</text></svg>">

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Space+Grotesk:wght@500;600;700&display=swap" rel="stylesheet">

  <!-- Styles -->
  <link rel="stylesheet" href="shared/css/marketing.css">
  <link rel="stylesheet" href="shared/css/shop.css">

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="shared/js/firebase-config.js"></script>
  <script src="shared/js/auth.js"></script>

  <!-- Anime.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>

  <!-- Shared Components -->
  <script src="shared/js/navbar.js" defer></script>
  <script src="shared/js/footer.js" defer></script>
  <script src="shared/js/whop-service.js" defer></script>
  <script src="shared/js/purchase-service.js" defer></script>
  <script src="shared/js/cart-service.js" defer></script>
</head>
<body>

  <!-- ==================== NAVIGATION ==================== -->
  <div id="navbar-container"></div>

  <!-- ==================== SHOP SUB-NAV ==================== -->
  <nav class="shop-subnav" id="shop-subnav">
    <div class="shop-subnav-container">
      <div class="shop-subnav-categories" id="subnav-categories">
        <button class="shop-subnav-item active" data-category="all">All</button>
        <button class="shop-subnav-item" data-category="ai-tees">AI Tees</button>
        <button class="shop-subnav-item" data-category="developer-hoodies">Developer Hoodies</button>
        <button class="shop-subnav-item" data-category="women-in-tech">Women in Tech</button>
        <button class="shop-subnav-item" data-category="limited-drops">Limited Drops</button>
        <button class="shop-subnav-item" data-category="starter-packs">Starter Packs</button>
        <button class="shop-subnav-item" data-category="accessories">Accessories</button>
        <button class="shop-subnav-item" data-category="courses">Courses</button>
      </div>
      <div class="shop-subnav-actions">
        <button class="shop-search-btn" id="search-toggle" aria-label="Search products">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
        </button>
        <button class="shop-cart-btn" id="cart-toggle" aria-label="Shopping cart">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/></svg>
          <span class="cart-badge" id="cart-badge">0</span>
        </button>
      </div>
    </div>
  </nav>

  <!-- ==================== HERO BANNER ==================== -->
  <section class="shop-hero-banner" id="hero">
    <div class="shop-hero-bg">
      <div class="hero-particles"></div>
      <div class="hero-light-streak"></div>
      <div class="hero-light-streak streak-2"></div>
    </div>
    <div class="shop-hero-container">
      <div class="shop-hero-text">
        <h1 class="shop-hero-title">
          ENGINEER YOUR FUTURE.<br>
          <span class="hero-accent">WEAR THE CODE.</span>
        </h1>
        <p class="shop-hero-subtitle">Premium AI-inspired streetwear for builders and innovators.</p>
        <div class="shop-hero-ctas">
          <a href="#products" class="btn btn-primary btn-lg">SHOP NOW</a>
          <a href="#courses" class="btn btn-secondary btn-lg">EXPLORE COLLECTIONS</a>
        </div>
        <div class="trust-badges">
          <div class="trust-badge">
            <span class="trust-icon">&#9733;</span>
            <span>4.8 Rating</span>
          </div>
          <div class="trust-badge">
            <span class="trust-icon">&#128666;</span>
            <span>Free Shipping $50+</span>
          </div>
          <div class="trust-badge">
            <span class="trust-icon">&#8635;</span>
            <span>30 Day Returns</span>
          </div>
        </div>
      </div>
      <div class="shop-hero-image">
        <div class="hero-glow"></div>
        <img src="assets/shop/logo-glow.png" alt="AutoNateAI" class="hero-logo-img">
      </div>
    </div>
  </section>

  <!-- ==================== PRODUCT GRID ==================== -->
  <section class="shop-products" id="products">
    <div class="shop-products-header">
      <h2 class="shop-products-title">Shop All</h2>
      <div class="shop-sort-wrapper">
        <label for="sort-select" class="sort-label">Sort by:</label>
        <select id="sort-select" class="sort-select">
          <option value="featured">Featured</option>
          <option value="price-asc">Price: Low to High</option>
          <option value="price-desc">Price: High to Low</option>
          <option value="newest">Newest</option>
          <option value="best-sellers">Best Sellers</option>
          <option value="top-rated">Top Rated</option>
        </select>
      </div>
    </div>
    <div class="product-grid" id="product-grid">
      <!-- Rendered by JS -->
    </div>
    <div class="product-grid-status" id="grid-status"></div>
  </section>

  <!-- ==================== FREQUENTLY BOUGHT TOGETHER ==================== -->
  <section class="fbt-section" id="fbt">
    <div class="fbt-wrapper">
      <h2 class="section-title-sm">Frequently Bought Together</h2>
      <div class="fbt-container" id="fbt-container">
        <!-- Rendered by JS -->
      </div>
    </div>
  </section>

  <!-- ==================== COURSES & LEARNING PATHS ==================== -->
  <section class="courses-section" id="courses">
    <div class="section-container">
      <div class="section-header">
        <span class="section-badge">LEARN &amp; BUILD</span>
        <h2 class="section-title">Level Up Your Skills</h2>
        <p class="section-subtitle">From complete beginner to senior engineer. AI-augmented courses with real-world projects.</p>
      </div>

      <!-- Featured Courses Carousel -->
      <div class="courses-carousel-wrapper">
        <div class="subsection-header">
          <h3 class="subsection-title">Featured Courses</h3>
          <div class="carousel-nav">
            <button class="carousel-btn carousel-prev" id="courses-prev" aria-label="Previous">&#8249;</button>
            <button class="carousel-btn carousel-next" id="courses-next" aria-label="Next">&#8250;</button>
          </div>
        </div>
        <div class="courses-carousel" id="courses-carousel">
          <!-- Rendered by JS -->
        </div>
      </div>

      <!-- Learning Paths -->
      <div class="learning-paths">
        <h3 class="subsection-title">Learning Paths</h3>
        <div class="paths-grid">
          <div class="path-card">
            <div class="path-icon">&#127891;</div>
            <div class="path-info">
              <h4>Zero to Developer</h4>
              <p>2 courses &bull; 12 weeks &bull; Certificate</p>
            </div>
            <a href="course/apprentice.html" class="path-cta">Start Path &#8594;</a>
          </div>
          <div class="path-card">
            <div class="path-icon">&#9889;</div>
            <div class="path-info">
              <h4>AI-Augmented Engineering</h4>
              <p>2 courses &bull; 8-16 weeks &bull; Certificate</p>
            </div>
            <a href="course/junior.html" class="path-cta">Start Path &#8594;</a>
          </div>
          <div class="path-card">
            <div class="path-icon">&#128640;</div>
            <div class="path-info">
              <h4>The Full Stack</h4>
              <p>All courses &bull; 24 weeks &bull; Master Certificate</p>
            </div>
            <a href="#" class="path-cta">Start Path &#8594;</a>
          </div>
        </div>
      </div>

      <!-- Enterprise Banner -->
      <div class="enterprise-banner">
        <div class="enterprise-text">
          <h3>AutoNateAI for Teams</h3>
          <p>Custom learning paths for your engineering team. Bulk pricing available.</p>
        </div>
        <a href="enterprise.html" class="btn btn-secondary">Contact Sales</a>
      </div>
    </div>
  </section>

  <!-- ==================== DROP OF THE MONTH ==================== -->
  <section class="drop-section" id="drop">
    <div class="drop-container">
      <div class="drop-info">
        <span class="drop-label">DROP OF THE MONTH</span>
        <h2 class="drop-title">DROP 01 &mdash; <span class="hero-accent">AI ORIGIN</span></h2>
        <div class="countdown" id="drop-countdown">
          <div class="countdown-unit">
            <span class="countdown-value" id="cd-days">00</span>
            <span class="countdown-label">Days</span>
          </div>
          <span class="countdown-sep">:</span>
          <div class="countdown-unit">
            <span class="countdown-value" id="cd-hours">00</span>
            <span class="countdown-label">Hours</span>
          </div>
          <span class="countdown-sep">:</span>
          <div class="countdown-unit">
            <span class="countdown-value" id="cd-mins">00</span>
            <span class="countdown-label">Min</span>
          </div>
          <span class="countdown-sep">:</span>
          <div class="countdown-unit">
            <span class="countdown-value" id="cd-secs">00</span>
            <span class="countdown-label">Sec</span>
          </div>
        </div>
        <p class="drop-desc">Pre-order the first limited-edition AutoNateAI drop engineered for AI visionaries.</p>
        <p class="drop-includes">Set incl. Tee, Free coaster, Matrix Dev Hoodie.</p>
        <button class="btn btn-secondary btn-glow">Reserve Your Spot</button>
      </div>
      <div class="drop-image">
        <div class="drop-glow"></div>
        <img src="assets/shop/ai-origin-drop-tee.png" alt="AI Origin Collection" class="drop-product-img">
        <span class="drop-collection-label">AI ORIGIN COLLECTION</span>
      </div>
    </div>
    <!-- Built for Builders alongside drop -->
    <div class="brand-story-card">
      <h3 class="brand-story-title">Built for Builders</h3>
      <ul class="brand-values-list">
        <li><span class="check-icon">&#10003;</span> Designed by Devs for Devs</li>
        <li><span class="check-icon">&#10003;</span> Premium, Sustainable Fabrics</li>
        <li><span class="check-icon">&#10003;</span> Supports the Tech Community</li>
      </ul>
      <a href="about.html" class="btn btn-secondary">Learn More</a>
    </div>
  </section>

  <!-- ==================== SOCIAL PROOF ==================== -->
  <section class="social-proof-strip">
    <div class="social-proof-content">
      <div class="testimonial-stars">&#9733;&#9733;&#9733;&#9733;&#9733;</div>
      <blockquote class="testimonial-quote">"Finally, gear that speaks our language."</blockquote>
      <cite class="testimonial-author">&mdash; Jay, Software Engineer</cite>
      <div class="proof-stats">
        <div class="proof-stat">
          <span class="proof-stat-value">4,200+</span>
          <span class="proof-stat-label">Community Members</span>
        </div>
        <div class="proof-stat">
          <span class="proof-stat-value">500+</span>
          <span class="proof-stat-label">Products Sold</span>
        </div>
        <div class="proof-stat">
          <span class="proof-stat-value">4.8/5</span>
          <span class="proof-stat-label">Average Rating</span>
        </div>
      </div>
    </div>
  </section>

  <!-- ==================== COMMUNITY GALLERY ==================== -->
  <section class="community-gallery" id="lookbook">
    <div class="gallery-header">
      <h2 class="section-title">#WeBotDatLife</h2>
      <p class="section-subtitle">The community repping AutoNateAI</p>
    </div>
    <div class="gallery-grid">
      <div class="gallery-item">
        <div class="gallery-placeholder">
          <img src="assets/shop/logo-glow.png" alt="AI Tees" class="gallery-logo-img" loading="lazy">
          <span class="gallery-label">AI Tees</span>
        </div>
        <div class="gallery-overlay"><span>Shop this look &#8594;</span></div>
      </div>
      <div class="gallery-item">
        <div class="gallery-placeholder">
          <img src="assets/shop/logo-glow.png" alt="Dev Hoodies" class="gallery-logo-img" loading="lazy">
          <span class="gallery-label">Dev Hoodies</span>
        </div>
        <div class="gallery-overlay"><span>Shop this look &#8594;</span></div>
      </div>
      <div class="gallery-item">
        <div class="gallery-placeholder">
          <img src="assets/shop/logo-glow.png" alt="Community" class="gallery-logo-img" loading="lazy">
          <span class="gallery-label">Community</span>
        </div>
        <div class="gallery-overlay"><span>Shop this look &#8594;</span></div>
      </div>
      <div class="gallery-item">
        <div class="gallery-placeholder">
          <img src="assets/shop/logo-glow.png" alt="Starter Packs" class="gallery-logo-img" loading="lazy">
          <span class="gallery-label">Starter Packs</span>
        </div>
        <div class="gallery-overlay"><span>Shop this look &#8594;</span></div>
      </div>
      <div class="gallery-item">
        <div class="gallery-placeholder">
          <img src="assets/shop/logo-glow.png" alt="Limited Drops" class="gallery-logo-img" loading="lazy">
          <span class="gallery-label">Limited Drops</span>
        </div>
        <div class="gallery-overlay"><span>Shop this look &#8594;</span></div>
      </div>
      <div class="gallery-item">
        <div class="gallery-placeholder">
          <img src="assets/shop/logo-glow.png" alt="Accessories" class="gallery-logo-img" loading="lazy">
          <span class="gallery-label">Accessories</span>
        </div>
        <div class="gallery-overlay"><span>Shop this look &#8594;</span></div>
      </div>
    </div>
  </section>

  <!-- ==================== MEMBERS SECTION ==================== -->
  <section class="members-section" id="members">
    <div class="members-container">
      <div class="members-text">
        <span class="section-badge">MEMBERSHIP</span>
        <h2 class="section-title">AutoNateAI Members Get More</h2>
        <ul class="members-perks">
          <li><span class="perk-icon">&#9889;</span> Early access to limited drops</li>
          <li><span class="perk-icon">&#128176;</span> Member-exclusive discounts</li>
          <li><span class="perk-icon">&#128666;</span> Free shipping on all orders</li>
          <li><span class="perk-icon">&#127891;</span> Priority course enrollment</li>
          <li><span class="perk-icon">&#128172;</span> Community feed access</li>
        </ul>
        <div class="members-ctas" id="members-ctas">
          <a href="auth/register.html" class="btn btn-primary">Join Free</a>
          <a href="auth/login.html" class="btn btn-secondary">Sign In</a>
        </div>
      </div>
      <div class="members-visual">
        <div class="members-logo-glow"></div>
        <img src="assets/shop/logo-glow.png" alt="AutoNateAI" class="members-logo-img">
        <span class="members-brand">AUTONATEAI</span>
        <small class="members-tagline">We Bot dat life</small>
      </div>
    </div>
  </section>

  <!-- ==================== FINAL CTA ==================== -->
  <section class="cta-section">
    <h2 class="cta-title">Gear Up. Stand Out. Build Different.</h2>
    <p class="cta-subtitle">Join the community of builders repping AutoNateAI. New drops every month.</p>
    <div class="cta-buttons">
      <a href="#products" class="btn btn-primary">Shop All Products <span>&#8594;</span></a>
      <a href="dashboard/feed.html" class="btn btn-secondary">Join the Community</a>
    </div>
  </section>

  <!-- ==================== FOOTER ==================== -->
  <div id="footer-container"></div>

  <!-- ==================== CART DRAWER ==================== -->
  <div class="cart-overlay" id="cart-overlay"></div>
  <div class="cart-drawer" id="cart-drawer">
    <div class="cart-drawer-header">
      <h3>Your Cart (<span id="cart-count">0</span>)</h3>
      <button class="cart-close" id="cart-close" aria-label="Close cart">&times;</button>
    </div>
    <div class="cart-drawer-items" id="cart-items"></div>
    <div class="cart-drawer-empty" id="cart-empty">
      <span class="empty-cart-icon">&#128722;</span>
      <p>Your cart is empty</p>
      <a href="#products" class="btn btn-primary btn-sm" id="start-shopping-btn">Start Shopping</a>
    </div>
    <div class="cart-upsell" id="cart-upsell">
      <h4>You might also like</h4>
      <div class="cart-upsell-items" id="cart-upsell-items"></div>
    </div>
    <div class="cart-drawer-footer" id="cart-footer">
      <div class="cart-subtotal">
        <span>Subtotal:</span>
        <span class="cart-total-price" id="cart-total-price">$0.00</span>
      </div>
      <p class="cart-shipping-note">Shipping calculated at checkout</p>
      <button class="btn btn-primary btn-full cart-checkout-btn" id="cart-checkout">Checkout <span>&#8594;</span></button>
    </div>
  </div>

  <!-- ==================== SEARCH OVERLAY ==================== -->
  <div class="search-overlay" id="search-overlay">
    <div class="search-modal">
      <div class="search-input-wrapper">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
        <input type="text" id="search-input" placeholder="Search products, courses..." autocomplete="off">
        <button class="search-close" id="search-close" aria-label="Close search">&times;</button>
      </div>
      <div class="search-results" id="search-results"></div>
    </div>
  </div>

  <!-- ==================== SCRIPTS ==================== -->
  <script>
    /* ========================================
       AutoNateAI Shop Page â€” Main Script
       ======================================== */

    let allProducts = [];
    let currentFilter = 'all';
    let currentSort = 'featured';

    document.addEventListener('DOMContentLoaded', () => {
      // Init shared components
      NavbarComponent.inject('navbar-container');
      FooterComponent.inject('footer-container');

      // Init cart
      if (typeof CartService !== 'undefined') {
        CartService.init();
      }

      // Handle purchase return
      if (typeof PurchaseService !== 'undefined') {
        const purchaseResult = PurchaseService.handlePurchaseReturn();
        if (purchaseResult) showPurchaseToast(purchaseResult);
      }

      // Load products & render
      loadProducts();

      // Setup interactions
      setupSubnavFilters();
      setupSortDropdown();
      setupCartDrawer();
      setupSearch();
      setupCountdown();
      setupMembersAuth();

      // Entry animations
      runEntryAnimations();
    });

    /* ---- PRODUCT LOADING ---- */
    function loadProducts() {
      if (typeof WhopService === 'undefined') return;
      allProducts = WhopService.getProducts();
      renderProducts();
      renderFBT();
      renderCoursesCarousel();
    }

    /* ---- RENDER PRODUCTS ---- */
    function renderProducts() {
      const grid = document.getElementById('product-grid');
      const status = document.getElementById('grid-status');
      if (!grid) return;

      let filtered = currentFilter === 'all'
        ? allProducts
        : allProducts.filter(p => p.category === currentFilter);

      // Sort
      filtered = sortProducts(filtered, currentSort);

      grid.innerHTML = '';

      if (filtered.length === 0) {
        grid.innerHTML = '<div class="no-results">No products found for this category.</div>';
        status.textContent = '';
        return;
      }

      status.textContent = `${filtered.length} product${filtered.length !== 1 ? 's' : ''}`;

      filtered.forEach(product => {
        grid.appendChild(createProductCard(product));
      });

      // Animate cards
      anime({
        targets: '#product-grid .product-card',
        opacity: [0, 1],
        translateY: [30, 0],
        delay: anime.stagger(60),
        duration: 500,
        easing: 'easeOutCubic'
      });
    }

    /* ---- CREATE PRODUCT CARD ---- */
    function createProductCard(product) {
      const card = document.createElement('div');
      card.className = `product-card${product.type === 'course' ? ' card-course' : ''}${product.type === 'bundle' ? ' card-bundle' : ''}`;
      card.dataset.category = product.category;
      card.dataset.type = product.type || 'merch';
      card.dataset.productId = product.id;

      // Badge
      const badgeHtml = product.badge
        ? `<span class="product-badge badge-${product.badge}">${formatBadge(product.badge)}</span>`
        : '';

      // Stars
      const starPercent = ((product.rating || 0) / 5) * 100;
      const reviewText = product.type === 'course'
        ? `(${(product.reviewCount || 0).toLocaleString()} students)`
        : `(${(product.reviewCount || 0).toLocaleString()})`;

      // Price
      const originalPriceHtml = product.originalPrice
        ? `<span class="product-price-original">$${product.originalPrice.toFixed(2)}</span>`
        : '';
      const discountHtml = product.originalPrice
        ? `<span class="discount-badge">${Math.round((1 - product.price / product.originalPrice) * 100)}% OFF</span>`
        : '';

      // Level badge (courses)
      const levelHtml = product.level
        ? `<span class="course-level level-${product.level}">${product.level.charAt(0).toUpperCase() + product.level.slice(1)}</span>`
        : '';

      // Instructor (courses)
      const instructorHtml = product.instructor
        ? `<p class="course-instructor">${product.instructor}</p>`
        : '';

      // Course meta
      const courseMetaHtml = product.chapters
        ? `<div class="course-meta-row">
            <span>&#128218; ${product.chapters} Chapters</span>
            ${product.capstones ? `<span>&#127919; ${product.capstones} Capstones</span>` : ''}
           </div>`
        : '';

      // Duration badge overlay
      const durationHtml = product.duration
        ? `<span class="course-duration-badge">${product.duration}</span>`
        : '';

      // Bundle contents
      const bundleHtml = product.type === 'bundle' && product.bundleContents
        ? `<p class="bundle-contents">${product.bundleContents}</p>
           <div class="bundle-savings">
             <span class="savings-label">You save:</span>
             <span class="savings-amount">$${(product.savings || 0).toFixed(2)} (${product.originalPrice ? Math.round((1 - product.price / product.originalPrice) * 100) : 0}%)</span>
           </div>`
        : '';

      // CTA text
      const ctaText = product.type === 'course' ? 'Enroll Now' : product.type === 'bundle' ? 'Add Bundle to Cart' : 'Add to Cart';
      const ctaIcon = product.type === 'course' ? '&#8594;' : '&#128722;';
      const ctaClass = product.type === 'course' ? 'btn-enroll' : product.type === 'bundle' ? 'btn-bundle' : '';

      // Image
      const imageHtml = product.image
        ? `<img src="${product.image}" alt="${product.name}" loading="lazy">`
        : `<div class="product-placeholder-img">
            <img src="assets/shop/logo-glow.png" alt="${product.name}" class="placeholder-logo-img" loading="lazy">
            <span class="placeholder-product-label">${product.name}</span>
          </div>`;

      card.innerHTML = `
        <div class="product-card-media">
          ${badgeHtml}
          ${imageHtml}
          ${durationHtml}
          <button class="quick-view-trigger" aria-label="Quick view ${product.name}">Quick View</button>
        </div>
        <div class="product-card-info">
          ${levelHtml}
          <h3 class="product-name">${product.name}</h3>
          ${instructorHtml}
          <div class="product-rating-row">
            <div class="star-rating" aria-label="${product.rating} out of 5 stars">
              <span class="stars-bg">&#9733;&#9733;&#9733;&#9733;&#9733;</span>
              <span class="stars-filled" style="width:${starPercent}%">&#9733;&#9733;&#9733;&#9733;&#9733;</span>
            </div>
            <span class="review-count">${reviewText}</span>
          </div>
          ${courseMetaHtml}
          ${bundleHtml}
          <div class="product-price-row">
            <span class="product-price">$${product.price.toFixed(2)}</span>
            ${originalPriceHtml}
            ${discountHtml}
          </div>
          <button class="btn-add-to-cart ${ctaClass}" data-product-id="${product.id}">
            ${ctaText} <span>${ctaIcon}</span>
          </button>
        </div>
      `;

      // Add to cart handler
      card.querySelector('.btn-add-to-cart').addEventListener('click', (e) => {
        e.stopPropagation();
        handleAddToCart(product);
      });

      return card;
    }

    /* ---- SORT PRODUCTS ---- */
    function sortProducts(products, sortBy) {
      const sorted = [...products];
      switch (sortBy) {
        case 'price-asc': return sorted.sort((a, b) => a.price - b.price);
        case 'price-desc': return sorted.sort((a, b) => b.price - a.price);
        case 'top-rated': return sorted.sort((a, b) => (b.rating || 0) - (a.rating || 0));
        case 'best-sellers': return sorted.sort((a, b) => (b.reviewCount || 0) - (a.reviewCount || 0));
        case 'newest': return sorted.sort((a, b) => (b.isNew ? 1 : 0) - (a.isNew ? 1 : 0));
        default: return sorted.sort((a, b) => (b.featured ? 1 : 0) - (a.featured ? 1 : 0));
      }
    }

    /* ---- FORMAT BADGE ---- */
    function formatBadge(badge) {
      return badge.replace(/-/g, ' ').toUpperCase();
    }

    /* ---- SUBNAV FILTERS ---- */
    function setupSubnavFilters() {
      const container = document.getElementById('subnav-categories');
      if (!container) return;
      container.addEventListener('click', (e) => {
        const btn = e.target.closest('.shop-subnav-item');
        if (!btn) return;
        container.querySelectorAll('.shop-subnav-item').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentFilter = btn.dataset.category;

        // Update title
        const title = document.querySelector('.shop-products-title');
        if (title) {
          title.textContent = currentFilter === 'all' ? 'Shop All' : btn.textContent;
        }

        renderProducts();

        // Scroll to products
        document.getElementById('products').scrollIntoView({ behavior: 'smooth', block: 'start' });
      });
    }

    /* ---- SORT DROPDOWN ---- */
    function setupSortDropdown() {
      const select = document.getElementById('sort-select');
      if (!select) return;
      select.addEventListener('change', () => {
        currentSort = select.value;
        renderProducts();
      });
    }

    /* ---- ADD TO CART ---- */
    function handleAddToCart(product) {
      if (typeof CartService !== 'undefined') {
        CartService.addItem(product.id, 1);
        CartService.openDrawer();
      } else {
        // Fallback to Whop checkout
        const user = window.AuthService?.getUser?.();
        if (user && user.email) {
          WhopService.createCheckout(product.id, user.email);
        } else {
          showEmailModal(product.id);
        }
      }
    }

    /* ---- CART DRAWER ---- */
    function setupCartDrawer() {
      const toggle = document.getElementById('cart-toggle');
      const close = document.getElementById('cart-close');
      const overlay = document.getElementById('cart-overlay');
      const startShopping = document.getElementById('start-shopping-btn');

      if (toggle) toggle.addEventListener('click', () => {
        if (typeof CartService !== 'undefined') CartService.openDrawer();
      });
      if (close) close.addEventListener('click', () => {
        if (typeof CartService !== 'undefined') CartService.closeDrawer();
      });
      if (overlay) overlay.addEventListener('click', () => {
        if (typeof CartService !== 'undefined') CartService.closeDrawer();
      });
      if (startShopping) startShopping.addEventListener('click', (e) => {
        e.preventDefault();
        if (typeof CartService !== 'undefined') CartService.closeDrawer();
        document.getElementById('products').scrollIntoView({ behavior: 'smooth' });
      });

      // Checkout button
      const checkoutBtn = document.getElementById('cart-checkout');
      if (checkoutBtn) {
        checkoutBtn.addEventListener('click', () => {
          if (typeof CartService === 'undefined') return;
          const items = CartService.getItems();
          if (items.length === 0) return;
          // For now, checkout first item via Whop
          const user = window.AuthService?.getUser?.();
          if (user && user.email) {
            WhopService.createCheckout(items[0].productId, user.email);
          } else {
            showEmailModal(items[0].productId);
          }
        });
      }
    }

    /* ---- FREQUENTLY BOUGHT TOGETHER ---- */
    function renderFBT() {
      const container = document.getElementById('fbt-container');
      if (!container || allProducts.length < 3) return;

      // Pick 3 complementary products
      const fbtItems = allProducts
        .filter(p => p.featured || p.badge === 'best-seller')
        .slice(0, 3);

      if (fbtItems.length < 3) return;

      const combined = fbtItems.reduce((sum, p) => sum + p.price, 0);
      const discounted = combined * 0.9; // 10% bundle discount

      container.innerHTML = fbtItems.map((item, i) => `
        ${i > 0 ? '<span class="fbt-plus">+</span>' : ''}
        <div class="fbt-item">
          ${item.image
            ? `<img src="${item.image}" alt="${item.name}" loading="lazy">`
            : `<div class="fbt-placeholder"><img src="assets/shop/logo-glow.png" alt="${item.name}" class="fbt-logo-img" loading="lazy"></div>`}
          <p>${item.name}</p>
          <span>$${item.price.toFixed(2)}</span>
        </div>
      `).join('') + `
        <div class="fbt-total">
          <p>Total: <span class="fbt-combined-price">$${discounted.toFixed(2)}</span> <span class="fbt-original">$${combined.toFixed(2)}</span></p>
          <button class="btn btn-primary btn-sm fbt-add-all">Add All 3 to Cart</button>
        </div>
      `;

      // Add all handler
      const addAllBtn = container.querySelector('.fbt-add-all');
      if (addAllBtn) {
        addAllBtn.addEventListener('click', () => {
          fbtItems.forEach(item => {
            if (typeof CartService !== 'undefined') CartService.addItem(item.id, 1);
          });
          if (typeof CartService !== 'undefined') CartService.openDrawer();
        });
      }
    }

    /* ---- COURSES CAROUSEL ---- */
    function renderCoursesCarousel() {
      const carousel = document.getElementById('courses-carousel');
      if (!carousel) return;

      const courses = allProducts.filter(p => p.type === 'course');
      if (courses.length === 0) return;

      carousel.innerHTML = courses.map(course => {
        const starPercent = ((course.rating || 0) / 5) * 100;
        return `
          <div class="carousel-course-card">
            <div class="carousel-course-img">
              ${course.image
                ? `<img src="${course.image}" alt="${course.name}" loading="lazy">`
                : `<div class="product-placeholder-img"><img src="assets/shop/logo-glow.png" alt="${course.name}" class="placeholder-logo-img" loading="lazy"></div>`}
              ${course.duration ? `<span class="course-duration-badge">${course.duration}</span>` : ''}
            </div>
            <div class="carousel-course-info">
              ${course.level ? `<span class="course-level level-${course.level}">${course.level.charAt(0).toUpperCase() + course.level.slice(1)}</span>` : ''}
              <h4>${course.name}</h4>
              <p class="course-instructor">${course.instructor || 'AutoNateAI Team'}</p>
              <div class="product-rating-row">
                <div class="star-rating">
                  <span class="stars-bg">&#9733;&#9733;&#9733;&#9733;&#9733;</span>
                  <span class="stars-filled" style="width:${starPercent}%">&#9733;&#9733;&#9733;&#9733;&#9733;</span>
                </div>
                <span class="review-count">(${(course.reviewCount || 0).toLocaleString()} students)</span>
              </div>
              <div class="product-price-row">
                <span class="product-price">$${course.price.toFixed(2)}</span>
                ${course.originalPrice ? `<span class="product-price-original">$${course.originalPrice.toFixed(2)}</span>` : ''}
              </div>
              <a href="${course.courseUrl || '#'}" class="btn btn-primary btn-sm">Enroll Now &#8594;</a>
            </div>
          </div>
        `;
      }).join('');

      // Carousel navigation
      const prev = document.getElementById('courses-prev');
      const next = document.getElementById('courses-next');
      if (prev) prev.addEventListener('click', () => {
        carousel.scrollBy({ left: -320, behavior: 'smooth' });
      });
      if (next) next.addEventListener('click', () => {
        carousel.scrollBy({ left: 320, behavior: 'smooth' });
      });
    }

    /* ---- COUNTDOWN TIMER ---- */
    function setupCountdown() {
      // Set drop date to 7 days from now
      const dropDate = new Date();
      dropDate.setDate(dropDate.getDate() + 7);
      dropDate.setHours(0, 0, 0, 0);

      function tick() {
        const now = Date.now();
        const diff = dropDate.getTime() - now;

        if (diff <= 0) {
          document.getElementById('drop-countdown').innerHTML = '<span class="drop-live">DROP IS LIVE &#128293;</span>';
          return;
        }

        const days = Math.floor(diff / 86400000);
        const hours = Math.floor((diff % 86400000) / 3600000);
        const mins = Math.floor((diff % 3600000) / 60000);
        const secs = Math.floor((diff % 60000) / 1000);

        const pad = (n) => String(n).padStart(2, '0');
        const setEl = (id, val) => { const el = document.getElementById(id); if (el) el.textContent = pad(val); };

        setEl('cd-days', days);
        setEl('cd-hours', hours);
        setEl('cd-mins', mins);
        setEl('cd-secs', secs);
      }

      tick();
      setInterval(tick, 1000);
    }

    /* ---- SEARCH ---- */
    function setupSearch() {
      const toggle = document.getElementById('search-toggle');
      const overlay = document.getElementById('search-overlay');
      const close = document.getElementById('search-close');
      const input = document.getElementById('search-input');
      const results = document.getElementById('search-results');

      if (!toggle || !overlay) return;

      toggle.addEventListener('click', () => {
        overlay.classList.add('active');
        setTimeout(() => input.focus(), 200);
      });

      close.addEventListener('click', () => overlay.classList.remove('active'));
      overlay.addEventListener('click', (e) => {
        if (e.target === overlay) overlay.classList.remove('active');
      });

      input.addEventListener('input', () => {
        const query = input.value.trim().toLowerCase();
        if (query.length < 2) { results.innerHTML = ''; return; }

        const matches = allProducts.filter(p =>
          p.name.toLowerCase().includes(query) ||
          (p.tags && p.tags.some(t => t.toLowerCase().includes(query))) ||
          (p.category && p.category.toLowerCase().includes(query))
        ).slice(0, 8);

        results.innerHTML = matches.length === 0
          ? '<p class="search-no-results">No products found</p>'
          : matches.map(p => `
            <div class="search-result-item" data-id="${p.id}">
              <div class="search-result-name">${p.name}</div>
              <div class="search-result-price">$${p.price.toFixed(2)}</div>
            </div>
          `).join('');

        // Click handler for results
        results.querySelectorAll('.search-result-item').forEach(item => {
          item.addEventListener('click', () => {
            overlay.classList.remove('active');
            input.value = '';
            results.innerHTML = '';
            // Scroll to product in grid
            const card = document.querySelector(`[data-product-id="${item.dataset.id}"]`);
            if (card) card.scrollIntoView({ behavior: 'smooth', block: 'center' });
          });
        });
      });

      // ESC to close
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && overlay.classList.contains('active')) {
          overlay.classList.remove('active');
        }
      });
    }

    /* ---- MEMBERS AUTH ---- */
    function setupMembersAuth() {
      // Check auth state and hide join CTAs if logged in
      if (typeof firebase !== 'undefined' && firebase.auth) {
        firebase.auth().onAuthStateChanged(user => {
          const ctas = document.getElementById('members-ctas');
          if (ctas && user) {
            ctas.innerHTML = `
              <a href="dashboard/index.html" class="btn btn-primary">Go to Dashboard</a>
              <a href="dashboard/library.html" class="btn btn-secondary">My Library</a>
            `;
          }
        });
      }
    }

    /* ---- ENTRY ANIMATIONS ---- */
    function runEntryAnimations() {
      // Hero
      anime({
        targets: '.shop-hero-text',
        opacity: [0, 1],
        translateY: [40, 0],
        duration: 900,
        easing: 'easeOutCubic'
      });

      anime({
        targets: '.shop-hero-image',
        opacity: [0, 1],
        translateX: [60, 0],
        duration: 900,
        delay: 200,
        easing: 'easeOutCubic'
      });

      anime({
        targets: '.trust-badges',
        opacity: [0, 1],
        translateY: [20, 0],
        duration: 600,
        delay: 500,
        easing: 'easeOutCubic'
      });

      anime({
        targets: '.shop-subnav',
        opacity: [0, 1],
        translateY: [-10, 0],
        duration: 500,
        delay: 300,
        easing: 'easeOutCubic'
      });

      // Scroll-triggered animations
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.classList.add('animate-in');
            observer.unobserve(entry.target);
          }
        });
      }, { threshold: 0.15 });

      document.querySelectorAll('.fbt-section, .courses-section, .drop-section, .social-proof-strip, .community-gallery, .members-section').forEach(el => {
        el.classList.add('animate-target');
        observer.observe(el);
      });
    }

    /* ---- EMAIL MODAL (fallback for non-cart checkout) ---- */
    function showEmailModal(productId) {
      const product = WhopService.getProduct(productId);
      if (!product) return;

      const overlay = document.createElement('div');
      overlay.className = 'email-modal-overlay';
      overlay.innerHTML = `
        <div class="email-modal">
          <h3>Complete Your Purchase</h3>
          <p>Enter your email to purchase <strong>${product.name}</strong> for $${product.price.toFixed(2)}.</p>
          <input type="email" id="checkout-email" placeholder="your@email.com" autocomplete="email">
          <div class="email-modal-actions">
            <button class="btn-cancel" id="modal-cancel">Cancel</button>
            <button class="btn-buy" id="modal-confirm">Continue to Checkout <span>&#8594;</span></button>
          </div>
        </div>
      `;

      document.body.appendChild(overlay);
      const emailInput = overlay.querySelector('#checkout-email');
      emailInput.focus();

      overlay.querySelector('#modal-confirm').addEventListener('click', () => {
        const email = emailInput.value.trim();
        if (!email || !email.includes('@')) { emailInput.style.borderColor = 'var(--accent-error)'; return; }
        overlay.remove();
        WhopService.createCheckout(productId, email);
      });
      overlay.querySelector('#modal-cancel').addEventListener('click', () => overlay.remove());
      overlay.addEventListener('click', (e) => { if (e.target === overlay) overlay.remove(); });
      emailInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') overlay.querySelector('#modal-confirm').click();
        if (e.key === 'Escape') overlay.remove();
      });
    }

    /* ---- PURCHASE TOAST ---- */
    function showPurchaseToast(result) {
      const name = result.product?.name || 'your product';
      const toast = document.createElement('div');
      toast.className = 'purchase-toast';
      toast.innerHTML = `
        <span class="purchase-toast-icon">&#9989;</span>
        <div class="purchase-toast-text">
          <span class="purchase-toast-title">Purchase Successful!</span>
          <span class="purchase-toast-desc">You now have access to ${name}.</span>
        </div>
        <button class="purchase-toast-close" aria-label="Close">&times;</button>
      `;
      document.body.appendChild(toast);
      toast.querySelector('.purchase-toast-close').addEventListener('click', () => toast.remove());
      setTimeout(() => { if (toast.parentNode) toast.remove(); }, 6000);
    }
  </script>
</body>
</html>

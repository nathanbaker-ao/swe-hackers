<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chapter 3: The Pull Between | Junior Accelerator</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=JetBrains+Mono&family=Space+Grotesk:wght@500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../../shared/css/lesson-interactive.css">
</head>
<body data-course="junior" data-lesson="ch3-magnetism">
  <header class="header">
    <div class="header-content">
      <a href="../../index.html" class="logo">
        <div class="logo-icon">ğŸ§²</div>
        <span>The Pull Between</span>
      </a>
      <nav class="nav-links">
        <a href="../index.html">â† Junior</a>
        <a href="../ch2-lightning/">Ch 2</a>
        <a href="index.html" class="active">Ch 3</a>
        <a href="../ch4-architect/">Ch 4: Architects</a>
      </nav>
    </div>
  </header>

  <main class="container">
    <div class="page-header">
      <div class="breadcrumb">
        <a href="../index.html">Junior Accelerator</a>
        <span>/</span>
        <span>Chapter 3: The Pull Between</span>
      </div>
      <h1>ğŸ§² The Pull Between</h1>
      <p>Juniors call APIs and hope they work. Seniors plan for when they don't. Learn to <strong>integrate like a professional</strong> â€” with retry logic, circuit breakers, and production-ready resilience.</p>
    </div>

    <!-- Audio Info -->
    <section class="section audio-info-section">
      <div class="info-box compact">
        <div class="info-header">
          <span class="info-icon">ğŸ™ï¸</span>
          <div>
            <h4>Interactive Learning Experience</h4>
            <p>Watch diagrams come alive with AI narration â€¢ Click dots to jump â€¢ Test your understanding with quizzes</p>
          </div>
        </div>
        <div class="voice-options">
          <span class="voice-badge">ğŸ‘©â€ğŸ¤ Female Storyteller</span>
          <span class="voice-badge">ğŸ© Male UK Storyteller</span>
        </div>
      </div>
    </section>

    <!-- Story 1: The Integration Trap -->
    <section class="section" id="integration-trap-section">
      <h2>The Integration Trap</h2>
      <p>Every junior has shipped an API integration that "worked in dev" only to get paged at 3am when production traffic revealed the gaps. Learn the mindset shift that separates juniors from seniors.</p>
      
      <div class="diagram-container" id="integration-trap-container">
        <div class="diagram-header">
          <span class="diagram-title">ğŸª¤ From Junior to Senior Integration</span>
        </div>
        <div id="integration-trap-story" class="diagram-canvas storytelling"></div>
        
        <div class="diagram-story" id="integration-trap-story-caption">
          <div class="story-step">
            <div class="story-icon visible">ğŸš€</div>
            <div class="story-content">
              <div class="story-title visible">Ready to Explore</div>
              <div class="story-text visible">Click any progress dot below to jump to that step, or press Play to watch the full story unfold.</div>
              <div class="story-connection" style="display: none;">
                <span class="arrow">â†’</span>
                <span class="connection-text"></span>
              </div>
            </div>
          </div>
        </div>

        <div class="playback-controls">
          <div class="playback-left">
            <button class="diagram-btn play-btn" data-action="play">â–¶ Play</button>
          </div>
          <div class="playback-center">
            <div class="story-progress" id="integration-trap-story-progress"></div>
          </div>
          <div class="playback-right">
            <button class="diagram-btn small" data-action="fit" title="Fit to view">Fit</button>
            <button class="diagram-btn small" data-action="reset" title="Reset view">Reset</button>
          </div>
        </div>

        <div class="settings-bar">
          <div class="control-group">
            <label>â±ï¸</label>
            <select id="integration-trap-speed-select">
              <option value="1000">1s</option>
              <option value="2000" selected>2s</option>
              <option value="5000">5s</option>
              <option value="10000">10s</option>
            </select>
          </div>
          <div class="control-group">
            <button class="audio-toggle" id="integration-trap-audio-toggle" title="Toggle audio narration">
              <span class="audio-icon">ğŸ”Š</span>
            </button>
          </div>
          <div class="control-group">
            <label>ğŸ¤</label>
            <select id="integration-trap-voice-select" class="voice-select">
              <option value="">Loading...</option>
            </select>
          </div>
        </div>
      </div>

      <div class="quiz-card" id="integration-trap-quiz">
        <div class="quiz-header">
          <h4>ğŸ“ Check Your Understanding</h4>
          <div class="quiz-progress">
            <span class="answered">0</span>/<span class="total">3</span> answered
            <span class="score"></span>
          </div>
        </div>
        <div class="quiz-carousel"></div>
        <div class="quiz-nav">
          <button class="quiz-nav-btn prev" disabled>â† Prev</button>
          <div class="quiz-dots"></div>
          <button class="quiz-nav-btn next">Next â†’</button>
        </div>
      </div>
    </section>

    <!-- Story 2: The Integration Checklist -->
    <section class="section" id="checklist-section">
      <h2>The Integration Checklist</h2>
      <p>Before any external integration goes to production, it must pass this checklist. Authentication, error handling, rate limiting, monitoring, testing â€” each layer protects you from a different failure mode.</p>
      
      <div class="diagram-container" id="checklist-container">
        <div class="diagram-header">
          <span class="diagram-title">âœ… Production-Ready Integration</span>
        </div>
        <div id="checklist-story" class="diagram-canvas storytelling"></div>
        
        <div class="diagram-story" id="checklist-story-caption">
          <div class="story-step">
            <div class="story-icon visible">ğŸš€</div>
            <div class="story-content">
              <div class="story-title visible">Ready to Explore</div>
              <div class="story-text visible">Click any progress dot below to jump to that step, or press Play to watch the full story unfold.</div>
              <div class="story-connection" style="display: none;">
                <span class="arrow">â†’</span>
                <span class="connection-text"></span>
              </div>
            </div>
          </div>
        </div>

        <div class="playback-controls">
          <div class="playback-left">
            <button class="diagram-btn play-btn" data-action="play">â–¶ Play</button>
          </div>
          <div class="playback-center">
            <div class="story-progress" id="checklist-story-progress"></div>
          </div>
          <div class="playback-right">
            <button class="diagram-btn small" data-action="fit" title="Fit to view">Fit</button>
            <button class="diagram-btn small" data-action="reset" title="Reset view">Reset</button>
          </div>
        </div>

        <div class="settings-bar">
          <div class="control-group">
            <label>â±ï¸</label>
            <select id="checklist-speed-select">
              <option value="1000">1s</option>
              <option value="2000" selected>2s</option>
              <option value="5000">5s</option>
              <option value="10000">10s</option>
            </select>
          </div>
          <div class="control-group">
            <button class="audio-toggle" id="checklist-audio-toggle" title="Toggle audio narration">
              <span class="audio-icon">ğŸ”Š</span>
            </button>
          </div>
          <div class="control-group">
            <label>ğŸ¤</label>
            <select id="checklist-voice-select" class="voice-select">
              <option value="">Loading...</option>
            </select>
          </div>
        </div>
      </div>

      <div class="quiz-card" id="checklist-quiz">
        <div class="quiz-header">
          <h4>ğŸ“ Check Your Understanding</h4>
          <div class="quiz-progress">
            <span class="answered">0</span>/<span class="total">3</span> answered
            <span class="score"></span>
          </div>
        </div>
        <div class="quiz-carousel"></div>
        <div class="quiz-nav">
          <button class="quiz-nav-btn prev" disabled>â† Prev</button>
          <div class="quiz-dots"></div>
          <button class="quiz-nav-btn next">Next â†’</button>
        </div>
      </div>
    </section>

    <!-- Story 3: Resilience Patterns -->
    <section class="section" id="resilience-section">
      <h2>Resilience Patterns</h2>
      <p>In distributed systems, failure is certain. The question isn't if external services will fail, but when. These battle-tested patterns â€” retry with backoff and circuit breakers â€” help your system survive gracefully.</p>
      
      <div class="diagram-container" id="resilience-container">
        <div class="diagram-header">
          <span class="diagram-title">ğŸ›¡ï¸ Circuit Breaker Pattern</span>
        </div>
        <div id="resilience-story" class="diagram-canvas storytelling"></div>
        
        <div class="diagram-story" id="resilience-story-caption">
          <div class="story-step">
            <div class="story-icon visible">ğŸš€</div>
            <div class="story-content">
              <div class="story-title visible">Ready to Explore</div>
              <div class="story-text visible">Click any progress dot below to jump to that step, or press Play to watch the full story unfold.</div>
              <div class="story-connection" style="display: none;">
                <span class="arrow">â†’</span>
                <span class="connection-text"></span>
              </div>
            </div>
          </div>
        </div>

        <div class="playback-controls">
          <div class="playback-left">
            <button class="diagram-btn play-btn" data-action="play">â–¶ Play</button>
          </div>
          <div class="playback-center">
            <div class="story-progress" id="resilience-story-progress"></div>
          </div>
          <div class="playback-right">
            <button class="diagram-btn small" data-action="fit" title="Fit to view">Fit</button>
            <button class="diagram-btn small" data-action="reset" title="Reset view">Reset</button>
          </div>
        </div>

        <div class="settings-bar">
          <div class="control-group">
            <label>â±ï¸</label>
            <select id="resilience-speed-select">
              <option value="1000">1s</option>
              <option value="2000" selected>2s</option>
              <option value="5000">5s</option>
              <option value="10000">10s</option>
            </select>
          </div>
          <div class="control-group">
            <button class="audio-toggle" id="resilience-audio-toggle" title="Toggle audio narration">
              <span class="audio-icon">ğŸ”Š</span>
            </button>
          </div>
          <div class="control-group">
            <label>ğŸ¤</label>
            <select id="resilience-voice-select" class="voice-select">
              <option value="">Loading...</option>
            </select>
          </div>
        </div>
      </div>

      <div class="quiz-card" id="resilience-quiz">
        <div class="quiz-header">
          <h4>ğŸ“ Check Your Understanding</h4>
          <div class="quiz-progress">
            <span class="answered">0</span>/<span class="total">3</span> answered
            <span class="score"></span>
          </div>
        </div>
        <div class="quiz-carousel"></div>
        <div class="quiz-nav">
          <button class="quiz-nav-btn prev" disabled>â† Prev</button>
          <div class="quiz-dots"></div>
          <button class="quiz-nav-btn next">Next â†’</button>
        </div>
      </div>
    </section>

    <!-- Next Steps -->
    <section class="section">
      <h2>Ready for Chapter 4?</h2>
      <p>You've learned to think about integrations like a senior â€” planning for failures, building resilience, and monitoring production. Now let's level up to design-first thinking and system architecture.</p>
      <div class="cards-grid" style="grid-template-columns: repeat(2, 1fr);">
        <a href="../ch4-architect/" class="card">
          <div class="card-icon">ğŸ—ï¸</div>
          <h3>Chapter 4: Design-First Thinking</h3>
          <p>Learn to design systems before coding them â€” architecture, trade-offs, and technical decisions.</p>
        </a>
        <a href="../index.html" class="card">
          <div class="card-icon">ğŸ“š</div>
          <h3>Course Overview</h3>
          <p>See all chapters in the Junior Accelerator.</p>
        </a>
      </div>
    </section>
  </main>

  <nav class="page-nav">
    <h4>On This Page</h4>
    <ul>
      <li><a href="#integration-trap-section">The Integration Trap</a></li>
      <li><a href="#checklist-section">The Checklist</a></li>
      <li><a href="#resilience-section">Resilience Patterns</a></li>
    </ul>
  </nav>

  <button class="back-to-top" title="Back to top">â†‘</button>

  <!-- External Libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.2/anime.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.28.1/cytoscape.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/dagre/0.8.5/dagre.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/cytoscape-dagre@2.5.0/cytoscape-dagre.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/cytoscape-cose-bilkent@4.1.0/cytoscape-cose-bilkent.min.js"></script>
  
  <!-- Interactive Engines -->
  <script src="../../shared/js/interactive/diagram-utils.js"></script>
  <script src="../../shared/js/interactive/audio-engine.js"></script>
  <script src="../../shared/js/interactive/storytelling-diagram.js"></script>
  <script src="../../shared/js/interactive/quiz-system.js"></script>
  
  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      // Initialize page animations
      DiagramUtils.initPageAnimations();
      DiagramUtils.setupBackToTop();

      // Load story and quiz data from JSON
      const response = await fetch('story.json');
      const pageData = await response.json();

      // Create a shared audio engine pointing to the audio folder
      const audioEngine = new AudioNarrationEngine('audio');

      // ============================================
      // DIAGRAM ELEMENTS (Cytoscape data)
      // ============================================

      const diagramElements = {
        'integration-trap': [
          // The journey from junior to senior
          { data: { id: 'task-arrives', label: 'ğŸ“‹ Task\nArrives', type: 'external', description: 'Integrate with Stripe' } },
          { data: { id: 'junior-approach', label: 'ğŸ‘¶ Junior\nApproach', type: 'concept', description: 'Copy example, ship it' } },
          { data: { id: 'three-am-page', label: 'ğŸš¨ 3am\nPage', type: 'auth', description: 'Rate limited in production' } },
          { data: { id: 'senior-approach', label: 'ğŸ§“ Senior\nApproach', type: 'service', description: 'Plan for failures' } },
          { data: { id: 'mindset-shift', label: 'ğŸ§  Mindset\nShift', type: 'page', description: 'Hope vs Plan' } },
          // Edges
          { data: { source: 'task-arrives', target: 'junior-approach' } },
          { data: { source: 'junior-approach', target: 'three-am-page' } },
          { data: { source: 'three-am-page', target: 'senior-approach' } },
          { data: { source: 'senior-approach', target: 'mindset-shift' } }
        ],

        'checklist': [
          // The checklist categories
          { data: { id: 'auth-security', label: 'ğŸ” Auth\n& Security', type: 'auth', description: 'Secrets vault, key rotation' } },
          { data: { id: 'error-handling', label: 'âš ï¸ Error\nHandling', type: 'external', description: 'Retry, circuit breaker, timeouts' } },
          { data: { id: 'rate-limiting', label: 'ğŸš¦ Rate\nLimiting', type: 'concept', description: 'Know limits, throttle, queue' } },
          { data: { id: 'monitoring', label: 'ğŸ“Š Monitoring', type: 'data', description: 'Latency, errors, business metrics' } },
          { data: { id: 'testing', label: 'ğŸ§ª Testing', type: 'service', description: 'Mocks, sandbox, failure scenarios' } },
          // Edges - sequential flow
          { data: { source: 'auth-security', target: 'error-handling' } },
          { data: { source: 'error-handling', target: 'rate-limiting' } },
          { data: { source: 'rate-limiting', target: 'monitoring' } },
          { data: { source: 'monitoring', target: 'testing' } }
        ],

        'resilience': [
          // Circuit breaker pattern
          { data: { id: 'why-resilience', label: 'ğŸ›¡ï¸ Why\nResilience', type: 'external', description: 'Failure is certain' } },
          { data: { id: 'retry-backoff', label: 'ğŸ”„ Retry +\nBackoff', type: 'concept', description: '1s, 2s, 4s delays' } },
          { data: { id: 'circuit-closed', label: 'âœ… Closed\nState', type: 'data', description: 'Normal operation' } },
          { data: { id: 'circuit-open', label: 'ğŸš« Open\nState', type: 'auth', description: 'Fail fast' } },
          { data: { id: 'circuit-recovery', label: 'ğŸ”§ Half-Open\nRecovery', type: 'service', description: 'Test & recover' } },
          // Edges
          { data: { source: 'why-resilience', target: 'retry-backoff' } },
          { data: { source: 'retry-backoff', target: 'circuit-closed' } },
          { data: { source: 'circuit-closed', target: 'circuit-open' } },
          { data: { source: 'circuit-open', target: 'circuit-recovery' } }
        ]
      };

      // ============================================
      // INITIALIZE STORYTELLING DIAGRAMS
      // ============================================

      // Map story IDs to diagram element keys
      const storyToDiagram = {
        'integration-trap-story': 'integration-trap',
        'checklist-story': 'checklist',
        'resilience-story': 'resilience'
      };

      // Create storytelling diagrams for each story in the JSON
      pageData.stories.forEach(story => {
        const diagramKey = storyToDiagram[story.id];
        if (!diagramKey) return;

        const elements = diagramElements[diagramKey];
        if (!elements) return;

        new StorytellingDiagram(
          story.id,
          elements,
          story.steps,
          { audioEngine, storyId: story.id }
        );
      });

      // ============================================
      // INITIALIZE QUIZZES
      // ============================================

      // Map story IDs to quiz container IDs
      const storyToQuiz = {
        'integration-trap-story': 'integration-trap-quiz',
        'checklist-story': 'checklist-quiz',
        'resilience-story': 'resilience-quiz'
      };

      pageData.quizzes.forEach(quiz => {
        const containerId = storyToQuiz[quiz.storyId];
        if (!containerId) return;

        new Quiz(containerId, quiz.questions);
      });
    });
  </script>
</body>
</html>
